version: 2.1
jobs:
  build:
    docker:
      - image: centos:latest
    steps:
      - checkout
      - run:
          name: Update OS and Install packages
          command: |
            yum -y update
            yum -y install epel-release
            yum -y install python-pip
      - run:
          name: Install Ionic SDK
          command: |
            pip install --upgrade pip
            pip install ionicsdk
      - run: 
          name: Canary
          command: |
            cat /etc/redhat-release
            python -V
            pip show ionicsdk
      - run:
          name: Import Profile
          command: |
            mkdir ../.ionicsecurity
            echo $IONIC_PROFILE | base64 --decode > ../.ionicsecurity/profile.pw
      - run:
          name: Activate Profile
          command: |
            cp python/set-active-profile/main.py set-active-profile.py
            echo stepOne
            sed -i '/persistor_path.=./ c\persistor_path = \"'$PROFILE_PATH'\"' set-active-profile.py
            diff python/set-active-profile/main.py set-active-profile.py
            echo stepTwoA
            sed -i '/profile_id.=./ c\profile_id = \"'$PROFILE_ID'\"' set-active-profile.py
            echo stepTwoB
            diff python/set-active-profile/main.py set-active-profile.py
      - run:
          name: initialize-agent-with-password-persistor
          command: |
            cd python/initialize-agent-with-password-persistor
            python main.py
#      - run:
#          name: hello world
#          command: |
#            cd python/ionic-helloworld
#            python main.py
#      - run:
#          name: get-key
#          command: |
#            cd python/get-key
#            python main.py
#      - run:
#          name: crypto-chunk-cipher
#          command: |
#            cd python/crypto-chunk-cipher
#            python main.py
